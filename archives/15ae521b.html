<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.ravenxrz.ink","root":"/","scheme":"Mist","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="i&gt; 本科毕设题目为《基于深度学习的图像去雾方法研究与实现》 毕设总结系列：  毕设总结零–绪论 毕设总结一–传统去雾理论 毕设总结二–论文复现工作1–暗通道去雾(DCP) 毕设总结三–论文复现工作2–MSCNN去雾 毕设总结四–最终去雾方案的确定与实现–DeBlurGanToDehaze 毕设总结五–杂项">
<meta property="og:type" content="article">
<meta property="og:title" content="毕设总结三-论文复现工作2-MSCNN去雾">
<meta property="og:url" content="https://www.ravenxrz.ink/archives/15ae521b.html">
<meta property="og:site_name" content="Raven&#39;s Blog">
<meta property="og:description" content="i&gt; 本科毕设题目为《基于深度学习的图像去雾方法研究与实现》 毕设总结系列：  毕设总结零–绪论 毕设总结一–传统去雾理论 毕设总结二–论文复现工作1–暗通道去雾(DCP) 毕设总结三–论文复现工作2–MSCNN去雾 毕设总结四–最终去雾方案的确定与实现–DeBlurGanToDehaze 毕设总结五–杂项">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ae01.alicdn.com/kf/HTB1fYn8dlKw3KVjSZFOq6yrDVXaL.jpg">
<meta property="og:image" content="https://ae01.alicdn.com/kf/HTB10WIwX3FY.1VjSZFqq6ydbXXaP.jpg">
<meta property="og:image" content="https://ae01.alicdn.com/kf/HTB1LKf7dgmH3KVjSZKzq6z2OXXas.jpg">
<meta property="article:published_time" content="2019-07-18T05:58:55.000Z">
<meta property="article:modified_time" content="2020-09-06T07:37:36.781Z">
<meta property="article:author" content="Raven">
<meta property="article:tag" content="图像去雾">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ae01.alicdn.com/kf/HTB1fYn8dlKw3KVjSZFOq6yrDVXaL.jpg">

<link rel="canonical" href="https://www.ravenxrz.ink/archives/15ae521b.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>毕设总结三-论文复现工作2-MSCNN去雾 | Raven's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Raven's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Raven's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">zhang.xingrui@foxmail.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-fa fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-fa fa-archive"></i>归档<span class="badge">125</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-fa fa-th"></i>分类<span class="badge">19</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-fa fa-tags"></i>标签<span class="badge">114</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-fa fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JhdmVueHJ6" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.ravenxrz.ink/archives/15ae521b.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://pic.downk.cc/item/5e907515504f4bcb04b6f798.jpg">
      <meta itemprop="name" content="Raven">
      <meta itemprop="description" content="分享技术，记录生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Raven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          毕设总结三-论文复现工作2-MSCNN去雾
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-18 13:58:55" itemprop="dateCreated datePublished" datetime="2019-07-18T13:58:55+08:00">2019-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-06 15:37:36" itemprop="dateModified" datetime="2020-09-06T15:37:36+08:00">2020-09-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>i&gt; 本科毕设题目为《基于深度学习的图像去雾方法研究与实现》</p>
<p>毕设总结系列：</p>
<ul>
<li><a href="https://www.ravenxrz.ink/archives/880ba6e.html">毕设总结零–绪论</a></li>
<li><a href="https://www.ravenxrz.ink/archives/a513887d.html">毕设总结一–传统去雾理论</a></li>
<li><a href="https://www.ravenxrz.ink/archives/81fcc536.html">毕设总结二–论文复现工作1–暗通道去雾(DCP)</a></li>
<li><a href="https://www.ravenxrz.ink/archives/15ae521b.html">毕设总结三–论文复现工作2–MSCNN去雾</a></li>
<li><a href="https://www.ravenxrz.ink/archives/6631bc9b.html">毕设总结四–最终去雾方案的确定与实现–DeBlurGanToDehaze</a></li>
<li><a href="https://www.ravenxrz.ink/archives/2caf6b87.html">毕设总结五–杂项</a><a id="more"></a>
<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2></li>
</ul>
<p>上一篇文章中，我们详细讲解分析了传统去雾方法DCP的原理及实现，本篇文章中，我们再来谈谈近年来火热的“深度学习”以及如何应用深度学习进行去雾。</p>
<p>本篇中的所有代码均已开源，地址将放于文末。</p>
<h2 id="2-一点题外话–浅谈深度学习"><a href="#2-一点题外话–浅谈深度学习" class="headerlink" title="2. 一点题外话–浅谈深度学习"></a>2. 一点题外话–浅谈深度学习</h2><p>自2012年ILSVRC竞赛中，基于深度学习的AlexNet已绝对优势获得冠军后，深度学习开始爆热。深度学习几乎成为AI的代名词，现已被运用到如自然语言处理、图像分类、语音识别等等诸多领域。要学习deep learning， 首先要知道什么是深度学习，以及”人工智能“、“机器学习“、”深度学习“的区别。</p>
<p>引用一篇博文中的定义，深度学习可这样定义：</p>
<blockquote>
<p>1.wiki：深度学习是机器学习的分支，它试图使用包含复杂结构或者由多重非线性变换构成的多个处理层对数据进行高层抽象的算法。<br>2.李彦宏：简单的说，深度学习就是一个函数集，如此而已。<br>3.深度学习将特征提取和分类结合到一个框架中，用数据学习特征，是一种可以自动学习特征的方法。<br>4.深度学习是一种特征学习方法，把原始的数据通过非线性的复杂模型转换为更高层次、更抽象的表达。</p>
</blockquote>
<p>下图很直观的展示这三者之间的关系。</p>
<p><img data-src="https://ae01.alicdn.com/kf/HTB1fYn8dlKw3KVjSZFOq6yrDVXaL.jpg"></p>
<p>再来谈谈近年来深度学习中的主角，卷积神经网络(CNN)。它有什么特点呢？一篇经典的文章里是这样描述它的：</p>
<blockquote>
<p>Convolutional Neural Networks (<strong>ConvNets</strong> or <strong>CNNs</strong>) are a category of <span class="exturl" data-url="aHR0cHM6Ly91amp3YWxrYXJuLm1lLzIwMTYvMDgvMDkvcXVpY2staW50cm8tbmV1cmFsLW5ldHdvcmtzLw==" title="https://ujjwalkarn.me/2016/08/09/quick-intro-neural-networks/">Neural Networks<i class="fa fa-external-link"></i></span> that have proven very effective in areas such as image recognition and classification. ConvNets have been successful in identifying faces, objects and traffic signs apart from powering vision in robots and self driving cars.</p>
</blockquote>
<p>也就是说，它特别<strong>擅长图像识别处理与分类</strong>。</p>
<p>这里推荐几篇文章学习CNN与了解CNN的进化史：</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91amp3YWxrYXJuLm1lLzIwMTYvMDgvMTEvaW50dWl0aXZlLWV4cGxhbmF0aW9uLWNvbnZuZXRzLw==" title="https://ujjwalkarn.me/2016/08/11/intuitive-explanation-convnets/">An Intuitive Explanation of Convolutional Neural Networks<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL3Njcy5yeWVyc29uLmNhL35haGFybGV5L3Zpcy9jb252L2ZsYXQuaHRtbA==" title="http://scs.ryerson.ca/~aharley/vis/conv/flat.html">CNN可视化<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2cxMWQxMTEvYXJ0aWNsZS9kZXRhaWxzLzgyMzUwNTYz" title="https://blog.csdn.net/g11d111/article/details/82350563">CNN概念之上采样，反卷积，Unpooling概念解释 - g11d111的博客 - CSDN博客<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL2F2NTQzMTE0MzcvP3A9MTk=" title="https://www.bilibili.com/video/av54311437/?p=19">CNN视频教程<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vc2t5ZnNtL3AvODQ1MTgzNC5odG1s" title="https://www.cnblogs.com/skyfsm/p/8451834.html">CNN网络架构演进：从LeNet到DenseNet - Madcola - 博客园<i class="fa fa-external-link"></i></span></li>
</ul>
<hr>
<h2 id="3-MSCNN去雾"><a href="#3-MSCNN去雾" class="headerlink" title="3.  MSCNN去雾"></a>3.  MSCNN去雾</h2><p>上小节算是一点题外话了，但是这篇的主题是基于深度学习的去雾，那么至少要知道什么是深度学习以及深度学习中最常用的CNN吧。</p>
<p>MSCNN,全称：《Single Image Dehazing via Multi-scale Convolutional Neural Networks》，由Ren等人于2016年提出。其思想在于<strong>学习雾图与其对应的透射图之间的映射关系，在基于某种算法估计大气光A，最后应用大气散射模型恢复出雾图。</strong>（不懂大气散射模型去雾的可参考本系列总结一）</p>
<p>个人认为这篇文章有3个核心关注点：</p>
<ol>
<li>提出了一种多尺度训练网络，这个网络分为了粗颗粒估计和细颗粒估计两个子网络。</li>
<li>采用NYU数据集合成出训练网络所有的雾图-透射图训练对。</li>
<li>利用估计出来的透射图和大气光，利用大气散射模型去雾。</li>
</ol>
<h3 id="3-1-MSCNN中的网络结构"><a href="#3-1-MSCNN中的网络结构" class="headerlink" title="3.1  MSCNN中的网络结构"></a>3.1  MSCNN中的网络结构</h3><p>先上一章总图：</p>
<p><img data-src="https://ae01.alicdn.com/kf/HTB10WIwX3FY.1VjSZFqq6ydbXXaP.jpg"></p>
<p>可以看到上半部为Coarse Net，下半部分为其Fine Net。由Coarse Net估计出Coarse Transmission Map，然后将它级联到Fine Net的第一个Upsample层后，在进行精细提取。简单说一下它的参数设置：</p>
<p>每一个长方体代表的是特征图，下面的数字代表的是卷积核的个数，下面的文字代表相应的操作和操作的size。</p>
<p><strong>训练损失函数上</strong>，MSCNN采用了MSE函数,即：</p>
<p>$$<br>L(t_i(x),t_i^{\delta}(x)) = \frac{1}{q}\sum_{i=1}^{q}||t_i(x)-t_i^{\delta}(x)||^2<br>$$</p>
<p>其中，q代表的是一个batch size中的雾图个数。</p>
<p><strong>其余参数：</strong></p>
<ul>
<li>采用sgd优化器，动量参数设置为0.9</li>
<li>batch size 设置为100</li>
<li>输入图进行归一化处理，统一为320*240</li>
<li>学习率设置0.01并且每20个epoch衰减0.1</li>
<li>总epoch设置为70</li>
</ul>
<h3 id="3-2-训练数据合成"><a href="#3-2-训练数据合成" class="headerlink" title="3.2 训练数据合成"></a>3.2 训练数据合成</h3><p>作者采用了NYU数据集来构建训练集。NYU数据集提供了清晰图与对应的深度图。合成公式：<br>$$<br>\left\{<br>\begin{array}{l}<br>t(x) = e^{-\beta d(x)}\\<br>I(x) = t(x) J(x) + A(1-t(x))<br>\end{array}<br>\right.<br>$$<br>现在已知d(x)和J(x)，通过随机取$\beta$和$A$，即可得到$t(x)$ 进而 获取$I(x)$雾图。详细的合成方法可参考:</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS91cmw/cT1odHRwczovL2FyeGl2Lm9yZy9wZGYvMTcxMi4wNDE0My5wZGYmc2E9RCZzbnR6PTEmdXNnPUFGUWpDTkh6ZHQza01Ec3Z1SjdFZjZSNGV2NTlPRmVSWUE=" title="https://www.google.com/url?q=https://arxiv.org/pdf/1712.04143.pdf&sa=D&sntz=1&usg=AFQjCNHzdt3kMDsvuJ7Ef6R4ev59OFeRYA">Benchmarking Single Image Dehazing and Beyond<i class="fa fa-external-link"></i></span> </li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zaXRlcy5nb29nbGUuY29tL3ZpZXcvcmVzaWRlLWRlaGF6ZS1kYXRhc2V0cy9yZXNpZGUtdjA=" title="https://sites.google.com/view/reside-dehaze-datasets/reside-v0">RESIDE<i class="fa fa-external-link"></i></span></li>
</ul>
<h3 id="3-3-整个去雾流程"><a href="#3-3-整个去雾流程" class="headerlink" title="3.3 整个去雾流程"></a>3.3 整个去雾流程</h3><p><img data-src="https://ae01.alicdn.com/kf/HTB1LKf7dgmH3KVjSZKzq6z2OXXas.jpg"></p>
<h2 id="4-搭建MSCNN网络结构参考代码"><a href="#4-搭建MSCNN网络结构参考代码" class="headerlink" title="4. 搭建MSCNN网络结构参考代码"></a>4. 搭建MSCNN网络结构参考代码</h2><p>代码基于Keras结构，不过MSCNN有MATLAB版本和Tensorflow版本，连接都放在了文末。</p>
<h3 id="4-1-设置超参数和辅助参数"><a href="#4-1-设置超参数和辅助参数" class="headerlink" title="4.1 设置超参数和辅助参数"></a>4.1 设置超参数和辅助参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">self.model_dir_path = <span class="string">&#x27;./model_save&#x27;</span></span><br><span class="line">self.trans_img_dir = <span class="string">&#x27;./dehazed_result/image/trans&#x27;</span></span><br><span class="line">self.trans_npy_dir = <span class="string">&#x27;./dehazed_result/npy/trans&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.model_dir_path):</span><br><span class="line">    os.mkdir(self.model_dir_path)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.trans_img_dir):</span><br><span class="line">    os.mkdir(self.trans_img_dir)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(self.trans_npy_dir):</span><br><span class="line">    os.mkdir(self.trans_npy_dir)</span><br><span class="line">self.coarse_model_name = <span class="string">&#x27;coarse_net.h5&#x27;</span></span><br><span class="line">self.fine_model_name = <span class="string">&#x27;fine_net.h5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置超参数</span></span><br><span class="line">self.batch_size = batch_size</span><br><span class="line">self.epochs = epochs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入图片信息</span></span><br><span class="line">self.img_height = <span class="number">240</span></span><br><span class="line">self.img_width = <span class="number">320</span></span><br><span class="line">self.channel = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-建立coraseNet"><a href="#4-2-建立coraseNet" class="headerlink" title="4.2 建立coraseNet"></a>4.2 建立coraseNet</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_build_coarseNet</span>(<span class="params">self, input_img</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    建立coarseNet</span></span><br><span class="line"><span class="string">    :param input_img: 输入图片的tensor</span></span><br><span class="line"><span class="string">    :return: coarseNet</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    conv1 = Conv2D(<span class="number">5</span>, (<span class="number">11</span>, <span class="number">11</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;coarseNet/conv1&#x27;</span>)(input_img)</span><br><span class="line">    pool1 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/pool1&#x27;</span>)(conv1)</span><br><span class="line">    upsample1 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/upsample1&#x27;</span>)(pool1)</span><br><span class="line">    normalize1 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;coarseNet/bn1&#x27;</span>)(upsample1)</span><br><span class="line">    <span class="comment"># dropout1 = Dropout(0.5, name=&#x27;coarseNet/dropout1&#x27;)(normalize1)</span></span><br><span class="line"></span><br><span class="line">    conv2 = Conv2D(<span class="number">5</span>, (<span class="number">9</span>, <span class="number">9</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;coarseNet/conv2&#x27;</span>)(normalize1)</span><br><span class="line">    pool2 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/pool2&#x27;</span>)(conv2)</span><br><span class="line">    upsample2 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/upsample2&#x27;</span>)(pool2)</span><br><span class="line">    normalize2 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;coarseNet/bn2&#x27;</span>)(upsample2)</span><br><span class="line">    <span class="comment"># dropout2 = Dropout(0.5, name=&#x27;coarseNet/dropout2&#x27;)(normalize2)</span></span><br><span class="line"></span><br><span class="line">    conv3 = Conv2D(<span class="number">10</span>, (<span class="number">7</span>, <span class="number">7</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;coarseNet/conv3&#x27;</span>)(normalize2)</span><br><span class="line">    pool3 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/pool3&#x27;</span>)(conv3)</span><br><span class="line">    upsample3 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/upsample3&#x27;</span>)(pool3)</span><br><span class="line">    <span class="comment"># dropout3 = Dropout(0.5, name=&#x27;coarseNet/dropout3&#x27;)(upsample3)</span></span><br><span class="line"></span><br><span class="line">    linear = LinearCombine(<span class="number">1</span>,name=<span class="string">&#x27;coarseNet/linear_combine&#x27;</span>)(upsample3)</span><br><span class="line">    <span class="keyword">return</span> linear</span><br></pre></td></tr></table></figure>

<p><code>LinearCombine</code>为一个自定义层:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCombine</span>(<span class="params">Layer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    paper 中的线性结合层</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, output_dim,**kwargs</span>):</span></span><br><span class="line">        self.output_dim = output_dim</span><br><span class="line">        super(LinearCombine, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build</span>(<span class="params">self, input_shape</span>):</span></span><br><span class="line">        self.kernel = self.add_weight(name=<span class="string">&#x27;kernel&#x27;</span>,</span><br><span class="line">                                      trainable=<span class="literal">True</span>,</span><br><span class="line">                                      shape=(input_shape[<span class="number">3</span>],),</span><br><span class="line">                                      initializer=<span class="string">&#x27;uniform&#x27;</span>)</span><br><span class="line">        self.biases = self.add_weight(name=<span class="string">&#x27;bias&#x27;</span>,</span><br><span class="line">                                      trainable=<span class="literal">True</span>,</span><br><span class="line">                                      shape=(self.output_dim,),</span><br><span class="line">                                      initializer=<span class="string">&#x27;normal&#x27;</span>)</span><br><span class="line">        super(LinearCombine, self).build(input_shape)  <span class="comment"># Be sure to call this at the end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span>(<span class="params">self, inputs, **kwargs</span>):</span></span><br><span class="line">        out = K.bias_add(</span><br><span class="line">            K.sum(tf.multiply(inputs, self.kernel), axis=<span class="number">3</span>),</span><br><span class="line">            self.biases</span><br><span class="line">        )</span><br><span class="line">        out = K.expand_dims(out,axis=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">return</span> K.sigmoid(out)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_output_shape</span>(<span class="params">self, input_shape</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (input_shape[<span class="number">0</span>],input_shape[<span class="number">1</span>],input_shape[<span class="number">2</span>],self.output_dim)</span><br></pre></td></tr></table></figure>

<h3 id="4-3-建立FineNet"><a href="#4-3-建立FineNet" class="headerlink" title="4.3 建立FineNet"></a>4.3 建立FineNet</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_build_fineNet</span>(<span class="params">input_img, coarseNet</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    建立fineNet</span></span><br><span class="line"><span class="string">    :param input_img: 输入图片的tensor</span></span><br><span class="line"><span class="string">    :param coarseNet: coarseNet的Tensor</span></span><br><span class="line"><span class="string">    :return: fineNet</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># paper中的fine net 卷积kernel为4. 但经查看作者提供的源代码，第一层设置的6</span></span><br><span class="line">    conv1 = Conv2D(<span class="number">6</span>, (<span class="number">7</span>, <span class="number">7</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;fineNet/conv1&#x27;</span>)(input_img)</span><br><span class="line">    pool1 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/pool1&#x27;</span>)(conv1)</span><br><span class="line">    upsample1 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/upsample1&#x27;</span>)(pool1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 级联coarseNet</span></span><br><span class="line">    concat = concatenate([upsample1, coarseNet], axis=<span class="number">3</span>, name=<span class="string">&#x27;concat&#x27;</span>)</span><br><span class="line">    normalize1 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;fineNet/bn1&#x27;</span>)(concat)</span><br><span class="line">    <span class="comment"># dropout1 = Dropout(0.5, name=&#x27;fineNet/dropout1&#x27;)(normalize1)</span></span><br><span class="line"></span><br><span class="line">    conv2 = Conv2D(<span class="number">5</span>, (<span class="number">5</span>, <span class="number">5</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>,name=<span class="string">&#x27;fineNet/conv2&#x27;</span>)(normalize1)</span><br><span class="line">    pool2 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/pool2&#x27;</span>)(conv2)</span><br><span class="line">    upsample2 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/upsample2&#x27;</span>)(pool2)</span><br><span class="line">    normalize2 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;fineNet/bn2&#x27;</span>)(upsample2)</span><br><span class="line">    <span class="comment"># dropout2 = Dropout(0.5, name=&#x27;fineNet/dropout2&#x27;)(normalize2)</span></span><br><span class="line"></span><br><span class="line">    conv3 = Conv2D(<span class="number">10</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>,name=<span class="string">&#x27;fineNet/conv3&#x27;</span>)(normalize2)</span><br><span class="line">    pool3 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/pool3&#x27;</span>)(conv3)</span><br><span class="line">    upsample3 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/upsample3&#x27;</span>)(pool3)</span><br><span class="line">    <span class="comment"># dropout3 = Dropout(0.5, name=&#x27;fineNet/dropout3&#x27;)(upsample3)</span></span><br><span class="line"></span><br><span class="line">    linear = LinearCombine(<span class="number">1</span>, name=<span class="string">&#x27;fineNet/linear_combine&#x27;</span>)(upsample3)</span><br><span class="line">    <span class="keyword">return</span> linear</span><br></pre></td></tr></table></figure>

<h3 id="4-4-设置训练的参数"><a href="#4-4-设置训练的参数" class="headerlink" title="4.4  设置训练的参数"></a>4.4  设置训练的参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置优化器，损失函数等</span></span><br><span class="line">self.optimizer = SGD(learning_rate,<span class="number">0.9</span>,<span class="number">0.0005</span>)</span><br><span class="line"><span class="comment"># self.optimizer = Adam(learning_rate, decay=1e-6)</span></span><br><span class="line">self.loss = mse</span><br><span class="line"></span><br><span class="line">self.coarseModel.compile(optimizer=self.optimizer,</span><br><span class="line">                         loss=self.loss)</span><br><span class="line">self.fineModel.compile(optimizer=self.optimizer,</span><br><span class="line">                       loss=self.loss)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-5-全代码"><a href="#4-5-全代码" class="headerlink" title="4.5  全代码"></a>4.5  全代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">网络模型搭建</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> keras.engine.topology <span class="keyword">import</span> Layer</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Conv2D, MaxPooling2D, UpSampling2D, Input, BatchNormalization</span><br><span class="line"><span class="keyword">from</span> keras.layers.merge <span class="keyword">import</span> concatenate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_net_model</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    建立paper中的MSCNN</span></span><br><span class="line"><span class="string">    :return: corseModel和fineModel的元祖</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    img_height = <span class="number">240</span></span><br><span class="line">    img_width = <span class="number">320</span></span><br><span class="line">    channel = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 通用输入</span></span><br><span class="line">    input_img = Input((img_height, img_width, channel))</span><br><span class="line">    coarseNet = _build_coarseNet(input_img)</span><br><span class="line">    fineNet = _build_fineNet(input_img, coarseNet)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 建立coarse Model和fine Model</span></span><br><span class="line">    coarseModel = Model(inputs=input_img, outputs=coarseNet)</span><br><span class="line">    fineModel = Model(inputs=input_img, outputs=fineNet)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># summary</span></span><br><span class="line">    coarseModel.summary()</span><br><span class="line">    fineModel.summary()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (coarseModel, fineModel)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_build_coarseNet</span>(<span class="params">input_img</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    建立coarseNet</span></span><br><span class="line"><span class="string">    :param input_img: 输入图片的tensor</span></span><br><span class="line"><span class="string">    :return: coarseNet</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    conv1 = Conv2D(<span class="number">5</span>, (<span class="number">11</span>, <span class="number">11</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;coarseNet/conv1&#x27;</span>)(input_img)</span><br><span class="line">    pool1 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/pool1&#x27;</span>)(conv1)</span><br><span class="line">    upsample1 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/upsample1&#x27;</span>)(pool1)</span><br><span class="line">    normalize1 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;coarseNet/bn1&#x27;</span>)(upsample1)</span><br><span class="line">    <span class="comment"># dropout1 = Dropout(0.5, name=&#x27;coarseNet/dropout1&#x27;)(normalize1)</span></span><br><span class="line"></span><br><span class="line">    conv2 = Conv2D(<span class="number">5</span>, (<span class="number">9</span>, <span class="number">9</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;coarseNet/conv2&#x27;</span>)(normalize1)</span><br><span class="line">    pool2 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/pool2&#x27;</span>)(conv2)</span><br><span class="line">    upsample2 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/upsample2&#x27;</span>)(pool2)</span><br><span class="line">    normalize2 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;coarseNet/bn2&#x27;</span>)(upsample2)</span><br><span class="line">    <span class="comment"># dropout2 = Dropout(0.5, name=&#x27;coarseNet/dropout2&#x27;)(normalize2)</span></span><br><span class="line"></span><br><span class="line">    conv3 = Conv2D(<span class="number">10</span>, (<span class="number">7</span>, <span class="number">7</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;coarseNet/conv3&#x27;</span>)(normalize2)</span><br><span class="line">    pool3 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/pool3&#x27;</span>)(conv3)</span><br><span class="line">    upsample3 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;coarseNet/upsample3&#x27;</span>)(pool3)</span><br><span class="line">    <span class="comment"># dropout3 = Dropout(0.5, name=&#x27;coarseNet/dropout3&#x27;)(upsample3)</span></span><br><span class="line"></span><br><span class="line">    linear = LinearCombine(<span class="number">1</span>, name=<span class="string">&#x27;coarseNet/linear_combine&#x27;</span>)(upsample3)</span><br><span class="line">    <span class="keyword">return</span> linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_build_fineNet</span>(<span class="params">input_img, coarseNet</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    建立fineNet</span></span><br><span class="line"><span class="string">    :param input_img: 输入图片的tensor</span></span><br><span class="line"><span class="string">    :param coarseNet: coarseNet的Tensor</span></span><br><span class="line"><span class="string">    :return: fineNet</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># paper中的fine net 卷积kernel为4. 但经查看作者提供的源代码，第一层设置的6</span></span><br><span class="line">    conv1 = Conv2D(<span class="number">6</span>, (<span class="number">7</span>, <span class="number">7</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;fineNet/conv1&#x27;</span>)(input_img)</span><br><span class="line">    pool1 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/pool1&#x27;</span>)(conv1)</span><br><span class="line">    upsample1 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/upsample1&#x27;</span>)(pool1)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 级联coarseNet</span></span><br><span class="line">    concat = concatenate([upsample1, coarseNet], axis=<span class="number">3</span>, name=<span class="string">&#x27;concat&#x27;</span>)</span><br><span class="line">    normalize1 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;fineNet/bn1&#x27;</span>)(concat)</span><br><span class="line">    <span class="comment"># dropout1 = Dropout(0.5, name=&#x27;fineNet/dropout1&#x27;)(normalize1)</span></span><br><span class="line"></span><br><span class="line">    conv2 = Conv2D(<span class="number">5</span>, (<span class="number">5</span>, <span class="number">5</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>,name=<span class="string">&#x27;fineNet/conv2&#x27;</span>)(normalize1)</span><br><span class="line">    pool2 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/pool2&#x27;</span>)(conv2)</span><br><span class="line">    upsample2 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/upsample2&#x27;</span>)(pool2)</span><br><span class="line">    normalize2 = BatchNormalization(axis=<span class="number">3</span>, name=<span class="string">&#x27;fineNet/bn2&#x27;</span>)(upsample2)</span><br><span class="line">    <span class="comment"># dropout2 = Dropout(0.5, name=&#x27;fineNet/dropout2&#x27;)(normalize2)</span></span><br><span class="line"></span><br><span class="line">    conv3 = Conv2D(<span class="number">10</span>, (<span class="number">3</span>, <span class="number">3</span>), padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>,name=<span class="string">&#x27;fineNet/conv3&#x27;</span>)(normalize2)</span><br><span class="line">    pool3 = MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/pool3&#x27;</span>)(conv3)</span><br><span class="line">    upsample3 = UpSampling2D((<span class="number">2</span>, <span class="number">2</span>), name=<span class="string">&#x27;fineNet/upsample3&#x27;</span>)(pool3)</span><br><span class="line">    <span class="comment"># dropout3 = Dropout(0.5, name=&#x27;fineNet/dropout3&#x27;)(upsample3)</span></span><br><span class="line"></span><br><span class="line">    linear = LinearCombine(<span class="number">1</span>, name=<span class="string">&#x27;fineNet/linear_combine&#x27;</span>)(upsample3)</span><br><span class="line">    <span class="keyword">return</span> linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearCombine</span>(<span class="params">Layer</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    paper 中的线性结合层</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, output_dim, **kwargs</span>):</span></span><br><span class="line">        self.output_dim = output_dim</span><br><span class="line">        super(LinearCombine, self).__init__(**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build</span>(<span class="params">self, input_shape</span>):</span></span><br><span class="line">        self.kernel = self.add_weight(name=<span class="string">&#x27;kernel&#x27;</span>,</span><br><span class="line">                                      trainable=<span class="literal">True</span>,</span><br><span class="line">                                      shape=(input_shape[<span class="number">3</span>],),</span><br><span class="line">                                      initializer=<span class="string">&#x27;uniform&#x27;</span>)</span><br><span class="line">        self.biases = self.add_weight(name=<span class="string">&#x27;bias&#x27;</span>,</span><br><span class="line">                                      trainable=<span class="literal">True</span>,</span><br><span class="line">                                      shape=(self.output_dim,),</span><br><span class="line">                                      initializer=<span class="string">&#x27;normal&#x27;</span>)</span><br><span class="line">        super(LinearCombine, self).build(input_shape)  <span class="comment"># Be sure to call this at the end</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span>(<span class="params">self, inputs, **kwargs</span>):</span></span><br><span class="line">        out = K.bias_add(</span><br><span class="line">            K.sum(tf.multiply(inputs, self.kernel), axis=<span class="number">3</span>),</span><br><span class="line">            self.biases</span><br><span class="line">        )</span><br><span class="line">        out = K.expand_dims(out, axis=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">return</span> K.sigmoid(out)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_output_shape</span>(<span class="params">self, input_shape</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (input_shape[<span class="number">0</span>], input_shape[<span class="number">1</span>], input_shape[<span class="number">2</span>], self.output_dim)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-6-其他"><a href="#4-6-其他" class="headerlink" title="4.6 其他"></a>4.6 其他</h3><p>代码中还有很多需要注意的地方，如接力学习，训练数据对的统一化处理，显存不足时，不应当将所有图片一次性加入到内存中，而应该采用generator的方式来训练，train过程多少epoch或batch需要sample一次等等。这些代码都可以参考文末的总代码，这里不可能一一道尽。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><span class="exturl" data-url="aHR0cHM6Ly9saW5rLnNwcmluZ2VyLmNvbS9jaGFwdGVyLzEwLjEwMDcvOTc4LTMtMzE5LTQ2NDc1LTZfMTA=" title="https://link.springer.com/chapter/10.1007/978-3-319-46475-6_10">Single Image Dehazing via Multi-scale Convolutional Neural Networks<i class="fa fa-external-link"></i></span></li>
</ol>
<p>所有源代码地址:</p>
<ol>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JhdmVuLWRlaGF6ZS13b3JrL01TQ05OX0tlcmFz" title="https://github.com/raven-dehaze-work/MSCNN_Keras">https://github.com/raven-dehaze-work/MSCNN_Keras<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JhdmVuLWRlaGF6ZS13b3JrL01TQ05OX01BVExBQg==" title="https://github.com/raven-dehaze-work/MSCNN_MATLAB">https://github.com/raven-dehaze-work/MSCNN_MATLAB<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Rpc2hhbmstYi9NU0NOTi1EZWhhemluZy1UZW5zb3JmbG93" title="https://github.com/dishank-b/MSCNN-Dehazing-Tensorflow">https://github.com/dishank-b/MSCNN-Dehazing-Tensorflow<i class="fa fa-external-link"></i></span></li>
</ol>

    </div>

    
    
    
        <div class="reward-container">
  <div>文章对你有帮助?打赏一下作者吧</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="https://pic.downk.cc/item/5d064208451253d178a15b27.png" alt="Raven 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="https://pic.downk.cc/item/5d0641c7451253d178a15376.png" alt="Raven 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Raven
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.ravenxrz.ink/archives/15ae521b.html" title="毕设总结三-论文复现工作2-MSCNN去雾">https://www.ravenxrz.ink/archives/15ae521b.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E5%9B%BE%E5%83%8F%E5%8E%BB%E9%9B%BE/" rel="tag"><i class="fa fa-tag"></i> 图像去雾</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/archives/81fcc536.html" rel="prev" title="毕设总结二-论文复现工作1-暗通道去雾(DCP)">
      <i class="fa fa-chevron-left"></i> 毕设总结二-论文复现工作1-暗通道去雾(DCP)
    </a></div>
      <div class="post-nav-item">
    <a href="/archives/6631bc9b.html" rel="next" title="毕设总结四-最终去雾方案的确定与实现-DeBlurGanToDehaze">
      毕设总结四-最终去雾方案的确定与实现-DeBlurGanToDehaze <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-前言"><span class="nav-text">1. 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-一点题外话–浅谈深度学习"><span class="nav-text">2. 一点题外话–浅谈深度学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-MSCNN去雾"><span class="nav-text">3.  MSCNN去雾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-MSCNN中的网络结构"><span class="nav-text">3.1  MSCNN中的网络结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-训练数据合成"><span class="nav-text">3.2 训练数据合成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-整个去雾流程"><span class="nav-text">3.3 整个去雾流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-搭建MSCNN网络结构参考代码"><span class="nav-text">4. 搭建MSCNN网络结构参考代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-设置超参数和辅助参数"><span class="nav-text">4.1 设置超参数和辅助参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-建立coraseNet"><span class="nav-text">4.2 建立coraseNet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-建立FineNet"><span class="nav-text">4.3 建立FineNet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-设置训练的参数"><span class="nav-text">4.4  设置训练的参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-全代码"><span class="nav-text">4.5  全代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-其他"><span class="nav-text">4.6 其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Raven"
      src="https://pic.downk.cc/item/5e907515504f4bcb04b6f798.jpg">
  <p class="site-author-name" itemprop="name">Raven</p>
  <div class="site-description" itemprop="description">分享技术，记录生活</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">114</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JhdmVueHJ6" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ravenxrz"><i class="fa fa-fw fa-fab fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnpoYWduLnhpbmdydWlAZm94bWFpbC5jb20=" title="E-Mail → mailto:zhagn.xingrui@foxmail.com"><i class="fa fa-fw fa-fa fa-envelope"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-fa fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="/resources" title="&#x2F;resources">我的资源</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Raven</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9taXN0LnRoZW1lLW5leHQub3Jn">NexT.Mist</span> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://www.ravenxrz.ink/archives/15ae521b.html',]
      });
      });
  </script>

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'b2fd373d2ca2e03e591e',
      clientSecret: 'de4ab066908c1fbd32d3a45e091b3538761d685b',
      repo        : 'BlogComment',
      owner       : 'ravenxrz',
      admin       : ['ravenxrz'],
      id          : '410e896dabfd89ce7bf0866044b951e0',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
